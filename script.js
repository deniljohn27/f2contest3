let data = [{"id":"bitcoin","symbol":"btc","name":"Bitcoin","image":"https://assets.coingecko.com/coins/images/1/large/bitcoin.png?1547033579","current_price":26749,"market_cap":518448650711,"market_cap_rank":1,"fully_diluted_valuation":561645009063,"total_volume":7549470803,"high_24h":26857,"low_24h":26355,"price_change_24h":372.46,"price_change_percentage_24h":1.41207,"market_cap_change_24h":6797128507,"market_cap_change_percentage_24h":1.32847,"circulating_supply":19384881.0,"total_supply":21000000.0,"max_supply":21000000.0,"ath":69045,"ath_change_percentage":-61.26875,"ath_date":"2021-11-10T14:24:11.849Z","atl":67.81,"atl_change_percentage":39337.10358,"atl_date":"2013-07-06T00:00:00.000Z","roi":null,"last_updated":"2023-05-27T05:59:19.504Z"},{"id":"ethereum","symbol":"eth","name":"Ethereum","image":"https://assets.coingecko.com/coins/images/279/large/ethereum.png?1595348880","current_price":1832.49,"market_cap":220206577323,"market_cap_rank":2,"fully_diluted_valuation":220206577323,"total_volume":6446739710,"high_24h":1838.28,"low_24h":1803.68,"price_change_24h":27.83,"price_change_percentage_24h":1.54194,"market_cap_change_24h":3072272796,"market_cap_change_percentage_24h":1.41492,"circulating_supply":120256773.085986,"total_supply":120256773.085986,"max_supply":null,"ath":4878.26,"ath_change_percentage":-62.46099,"ath_date":"2021-11-10T14:24:19.604Z","atl":0.432979,"atl_change_percentage":422842.27122,"atl_date":"2015-10-20T00:00:00.000Z","roi":{"times":90.60187300197344,"currency":"btc","percentage":9060.187300197345},"last_updated":"2023-05-27T05:59:15.743Z"},{"id":"tether","symbol":"usdt","name":"Tether","image":"https://assets.coingecko.com/coins/images/325/large/Tether.png?1668148663","current_price":1.0,"market_cap":83159062198,"market_cap_rank":3,"fully_diluted_valuation":83159062198,"total_volume":17054310710,"high_24h":1.002,"low_24h":0.998603,"price_change_24h":-0.000354621859659954,"price_change_percentage_24h":-0.03543,"market_cap_change_24h":98223291,"market_cap_change_percentage_24h":0.11825,"circulating_supply":83122088781.306,"total_supply":83122088781.306,"max_supply":null,"ath":1.32,"ath_change_percentage":-24.41412,"ath_date":"2018-07-24T00:00:00.000Z","atl":0.572521,"atl_change_percentage":74.67887,"atl_date":"2015-03-02T00:00:00.000Z","roi":null,"last_updated":"2023-05-27T05:55:00.955Z"},{"id":"binancecoin","symbol":"bnb","name":"BNB","image":"https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png?1644979850","current_price":306.89,"market_cap":48453380699,"market_cap_rank":4,"fully_diluted_valuation":61377569601,"total_volume":280926785,"high_24h":308.76,"low_24h":302.05,"price_change_24h":4.74,"price_change_percentage_24h":1.56804,"market_cap_change_24h":642442965,"market_cap_change_percentage_24h":1.34372,"circulating_supply":157886280.0,"total_supply":157900174.0,"max_supply":200000000.0,"ath":686.31,"ath_change_percentage":-55.28406,"ath_date":"2021-05-10T07:24:17.097Z","atl":0.0398177,"atl_change_percentage":770633.85767,"atl_date":"2017-10-19T00:00:00.000Z","roi":null,"last_updated":"2023-05-27T05:59:19.097Z"},{"id":"usd-coin","symbol":"usdc","name":"USD Coin","image":"https://assets.coingecko.com/coins/images/6319/large/USD_Coin_icon.png?1547042389","current_price":1.0,"market_cap":29081238328,"market_cap_rank":5,"fully_diluted_valuation":29081419296,"total_volume":1513491122,"high_24h":1.005,"low_24h":0.997699,"price_change_24h":-0.000172460152939369,"price_change_percentage_24h":-0.01724,"market_cap_change_24h":46183747,"market_cap_change_percentage_24h":0.15906,"circulating_supply":29083235103.5096,"total_supply":29083416084.0196,"max_supply":null,"ath":1.17,"ath_change_percentage":-14.78089,"ath_date":"2019-05-08T00:40:28.300Z","atl":0.877647,"atl_change_percentage":13.86926,"atl_date":"2023-03-11T08:02:13.981Z","roi":null,"last_updated":"2023-05-27T05:59:13.460Z"},{"id":"ripple","symbol":"xrp","name":"XRP","image":"https://assets.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png?1605778731","current_price":0.472462,"market_cap":24579141246,"market_cap_rank":6,"fully_diluted_valuation":47282686134,"total_volume":1031539452,"high_24h":0.478057,"low_24h":0.461198,"price_change_24h":0.00951083,"price_change_percentage_24h":2.05439,"market_cap_change_24h":537550345,"market_cap_change_percentage_24h":2.23592,"circulating_supply":51983386003.0,"total_supply":99988920499.0,"max_supply":100000000000.0,"ath":3.4,"ath_change_percentage":-86.08975,"ath_date":"2018-01-07T00:00:00.000Z","atl":0.00268621,"atl_change_percentage":17498.53293,"atl_date":"2014-05-22T00:00:00.000Z","roi":null,"last_updated":"2023-05-27T05:59:15.963Z"},{"id":"cardano","symbol":"ada","name":"Cardano","image":"https://assets.coingecko.com/coins/images/975/large/cardano.png?1547034860","current_price":0.365261,"market_cap":12806479096,"market_cap_rank":7,"fully_diluted_valuation":16444320639,"total_volume":181525718,"high_24h":0.366809,"low_24h":0.356161,"price_change_24h":0.00888198,"price_change_percentage_24h":2.49228,"market_cap_change_24h":320449103,"market_cap_change_percentage_24h":2.56646,"circulating_supply":35045020830.3234,"total_supply":45000000000.0,"max_supply":45000000000.0,"ath":3.09,"ath_change_percentage":-88.16171,"ath_date":"2021-09-02T06:00:10.474Z","atl":0.01925275,"atl_change_percentage":1798.10624,"atl_date":"2020-03-13T02:22:55.044Z","roi":null,"last_updated":"2023-05-27T05:59:14.463Z"},{"id":"staked-ether","symbol":"steth","name":"Lido Staked Ether","image":"https://assets.coingecko.com/coins/images/13442/large/steth_logo.png?1608607546","current_price":1829.77,"market_cap":12362829013,"market_cap_rank":8,"fully_diluted_valuation":12362829013,"total_volume":5448276,"high_24h":1837.45,"low_24h":1802.86,"price_change_24h":26.1,"price_change_percentage_24h":1.44715,"market_cap_change_24h":274580187,"market_cap_change_percentage_24h":2.27146,"circulating_supply":6758408.46580876,"total_supply":6758408.46580876,"max_supply":6758408.46580876,"ath":4829.57,"ath_change_percentage":-62.13715,"ath_date":"2021-11-10T14:40:47.256Z","atl":482.9,"atl_change_percentage":278.67617,"atl_date":"2020-12-22T04:08:21.854Z","roi":null,"last_updated":"2023-05-27T05:58:33.034Z"},{"id":"dogecoin","symbol":"doge","name":"Dogecoin","image":"https://assets.coingecko.com/coins/images/5/large/dogecoin.png?1547792256","current_price":0.071557,"market_cap":9985971793,"market_cap_rank":9,"fully_diluted_valuation":null,"total_volume":188326828,"high_24h":0.071865,"low_24h":0.070594,"price_change_24h":0.00087582,"price_change_percentage_24h":1.23911,"market_cap_change_24h":133065505,"market_cap_change_percentage_24h":1.35052,"circulating_supply":139514466383.705,"total_supply":null,"max_supply":null,"ath":0.731578,"ath_change_percentage":-90.21311,"ath_date":"2021-05-08T05:08:23.458Z","atl":8.69e-05,"atl_change_percentage":82288.53549,"atl_date":"2015-05-06T00:00:00.000Z","roi":null,"last_updated":"2023-05-27T05:59:21.753Z"},{"id":"matic-network","symbol":"matic","name":"Polygon","image":"https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png?1624446912","current_price":0.920431,"market_cap":8539219878,"market_cap_rank":10,"fully_diluted_valuation":9202272042,"total_volume":435366489,"high_24h":0.941255,"low_24h":0.8901,"price_change_24h":0.030287,"price_change_percentage_24h":3.40248,"market_cap_change_24h":256912101,"market_cap_change_percentage_24h":3.10194,"circulating_supply":9279469069.28493,"total_supply":10000000000.0,"max_supply":10000000000.0,"ath":2.92,"ath_change_percentage":-68.45393,"ath_date":"2021-12-27T02:08:34.307Z","atl":0.00314376,"atl_change_percentage":29163.24807,"atl_date":"2019-05-10T00:00:00.000Z","roi":{"times":348.9738558864193,"currency":"usd","percentage":34897.38558864193},"last_updated":"2023-05-27T05:59:14.335Z"}];

// let data1=fetch(" https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false")
// let data=[];
// data1.then((content)=>{
//     // console.log(content instanceof Response)
//     let extractedData=content.json();

//     extractedData.then((originalData)=>{
//         data=originalData;
//         loadData(originalData);
//     })
//     console.log(extractedData)
//     console.log("success")
// });
// data1.catch(()=>{
//     console.log("failure")
// });
let contaner=document.getElementById("displayContainer");


function loadData(data){

    for(let i=0;i<data.length;i++){
        
        let row=document.createElement("tr");

        let image=data[i].image;
        let namet=data[i].name;
        let symbolt=data[i].symbol.toUpperCase();
        let currPricet="$"+new Intl.NumberFormat().format(data[i].current_price);
        let dilutiont="$"+new Intl.NumberFormat().format(data[i].fully_diluted_valuation);
        let percentaget=data[i].price_change_percentage_24h.toFixed(2)+"%";
        let mktCapt=`Mkt Cap :$${new Intl.NumberFormat().format(data[i].market_cap)}`;

        console.log(contaner,row,image,namet,symbolt,currPricet,dilutiont,percentaget,mktCapt);
        let pic=document.createElement("img");
        pic.src=image;
        
        let col1=document.createElement("td");
        col1.append(pic);
        
        let col2=document.createElement("td");
        col2.innerText=namet;
        
        let col3=document.createElement("td");
        col3.innerText=symbolt;
        
        let col4=document.createElement("td");
        col4.innerText=currPricet;
        col4.className="right_align"

        let col5=document.createElement("td");
        col5.innerText=dilutiont;
        col5.className="right_align"

        let col6=document.createElement("td");
        col6.innerText=percentaget;
        let cond=data[i].price_change_percentage_24h;
        if(cond>0){
            col6.className="right_align green"
        }else{
            col6.className="right_align red"
        }

        let col7=document.createElement("td");
        col7.innerText=mktCapt;
        col7.className="right_align"

        row.append(col1);
        row.append(col2);
        row.append(col3);
        row.append(col4);
        row.append(col5);
        row.append(col6);
        row.append(col7);

        contaner.append(row);
    }    
    
}

let sortMktBtn=document.getElementById("mketBtn");
let sortPertBtn=document.getElementById("percentageBtn");
sortMktBtn.addEventListener("click",sortByMkt);
sortPertBtn.addEventListener("click",sortByPer);

function sortByMkt(){
    contaner.innerHTML=' ';
    let mktSort=data.sort((a,b)=>{return a.market_cap-b.market_cap});
    loadData(mktSort);
}

function sortByPer(){
    contaner.innerHTML=' ';
    let perSort=data.sort((a,b)=>{return a.price_change_percentage_24h-b.price_change_percentage_24h});
    loadData(perSort);
}
search.addEventListener("input",searchFunction);

function searchFunction(){
    let search=document.getElementById("search");
   // console.log(search.value)
    if(search.value==""){
        contaner.innerHTML=' ';
        loadData(data);
    }else{
        let word=search.value.toLowerCase();
        let matchArr=[];
        for(let i =0;i<data.length;i++){
            if(data[i].name.toLowerCase().includes(word)||data[i].symbol.toLowerCase().includes(word)){
                matchArr.push(data[i]);
            }
        }
        contaner.innerHTML=' ';
        loadData(matchArr);
    }

}
loadData(data);